<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Visualization 1 Prototype</title>

    <!-- ADD Libraries-->
    <script src="libs/d3/d3.min.js" charset="utf-8"></script>
    <script src="libs/jquery/jquery-2.1.1.min.js" charset="utf-8"></script>
    <script src="libs/bootstrap/js/bootstrap.min.js" charset="utf-8"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>
    <!-- Load c3.js -->
    <script src="libs/c3/c3-0.4.10/c3.min.js"></script>

    <!--Stylesheets-->
    <link rel="stylesheet" type="text/css" href="libs/bootstrap/css/bootstrap.min.css"> 
    <!-- Load c3.css -->
    <link href="libs/c3/c3-0.4.10/c3.css" rel="stylesheet" type="text/css">
   
    <!-- Get some nice font-->
    <link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700' rel='stylesheet' type='text/css'>

    <!-- add own vis classes-->
    <!--<script src = "js/priovis.js"></script>-->
    <!--<script src = "js/agevis.js"></script>-->
    <!--<script src = "js/countvis.js"></script>-->

    <!-- add own stylesheet-->
    <!--<link rel="stylesheet" type="text/css" href="css/myStyle.css">-->

</head>
<body>
    <div class="container">
        <h1>Visualization 1 Prototype</h1>
    </div>   
    <div> 
    	<button class="small" onclick="hide();">Hide</button>
    	<button class="small" onclick="show();">Show</button>
    </div>
	<div id="chart"></div>
</body>	
	<script>

        //-----------------//
        // -- LOAD DATA -- //
        //-----------------//    

        d3.json("data/project_data_original_structure.json", function(error, data) {

    	    var allData = []
            allData[0] = data

            //---------------------------------------//
            // -- GENERATE LIST OF UNIQUE COUPLES -- //
            //---------------------------------------//

            // Map through all data to pull out ID's of all couples competing in each event (duplicates present) 
            var allIDs = [];
            allData.map(function(d,i) {
                d.events.map(function(e,j) {
                    e.results.map(function(r,k) {
                        allIDs.push(r["coupleid"]);
                    })
                })
            });        
            allIDs.sort()

            // Keep only unique couple ID's
            uniqueIDs = [];
            for (var i = 0; i < allIDs.length - 1; i++) {
                if (allIDs[i + 1] == allIDs[i]) {
                    uniqueIDs.push(allIDs[i]);
                }
            }

            //-----------------------------------------//
            // -- SET UP STRUCTURE FOR FINAL OBJECT -- //
            //-----------------------------------------//

            // Generate array of objects to hold information and results for each unique couple
            var couples = d3.range(0,uniqueIDs.length).map(function(){ return { }; })
            
            // Generate "events" array for each couple to hold the number of events that couple competed in
            var eventCount = 0    
            uniqueIDs.forEach(function(c, i) {
                allData.forEach(function(d) {
                    d.events.forEach(function(e) {
                        e.results.forEach(function(r) {
                            if (r.coupleid == c) {
                                eventCount ++;
                            }
                        })
                    })
                })
                couples[i]["events"] = d3.range(0,eventCount).map(function(){ return { }; })
                eventCount = 0;
            });

            //-----------------------------------------------------------------//
            // -- POPULATE "COUPLES" ARRAY AND "EVENTS" ARRAY WITHIN COUPLES-- //
            //-----------------------------------------------------------------//

            // For each unique id map through all data and populate arrays
            uniqueIDs.map(function(c, i) {
                eventCount = 0
                allData.map(function(d) {
                    d.events.map(function(e) {
                        e.results.map(function(r) {
                            couples[i]["coupleid"] = c;
                            couples[i]["names"] = r["couple"];
                            couples[i]["counry"] = r["country"];
                            if (r.coupleid == c) {
                                couples[i].events[eventCount]["score"] = r["score"];
                                couples[i].events[eventCount]["change"] = r["change"];
                                couples[i].events[eventCount]["date"] = e["date"];
                                couples[i].events[eventCount]["style"] = e["style"];
                                couples[i].events[eventCount]["compid"] = d["compid"];
                                couples[i].events[eventCount]["compname"] = d["name"];                        
                                eventCount++;
                            }
                        })
                    })
                })
            })
            console.log(couples)
        });

</script>






